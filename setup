#!/bin/bash
set -e

# Make sure is run as root ...
if [[ $UID != 0 ]]; then
    sudo "$0" "$@"
    exit $?
fi

# Install xcodebuild shim ...
# http://randomfoo.net/2012/08/03/macports-without-xcode
mv /usr/bin/xcodebuild /usr/bin/xcodebuild.orig
cp res/xcodebuild /usr/bin
chmod +x /usr/bin/xcodebuild
xcode-select -switch /usr/bin

# Install all the things ...
port install \
    php54 \
    php54-apc \
    php54-curl \
    php54-http \
    php54-mbstring \
    php54-mcrypt \
    php54-mysql \
    php54-openssl \
    php54-pcntl \
    php54-posix \
    php54-soap \
    php54-xdebug \
    php54-zip \
    gcc47 \
    subversion \
    git-core \
    git-flow \
    hub \
    nodejs \
    npm

# Make PHP 5.4 the default ...
port select php php54
cp res/php.ini /opt/local/etc/php54

mkdir -p /usr/local/bin

# Install composer ...
curl -s https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin
mv /usr/local/bin/composer.phar /usr/local/bin/composer

# Install phpunit ...
curl -s http://pear.phpunit.de/get/phpunit.phar -o /usr/local/bin/phpunit
chmod +x /usr/local/bin/phpunit

# Install coffeescript ...
npm install -g coffee-script
